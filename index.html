<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>RECORDATORIO DE CITAS</title>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<link rel="manifest" href="manifest.webmanifest">
<link rel="apple-touch-icon" href="icon-180.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#0ea5e9">
<style>
  *,*::before,*::after{ box-sizing:border-box }
  :root{
    --bg:#0f172a; --card:#111827; --muted:#9ca3af; --text:#e5e7eb; --accent:#06b6d4; --border:rgba(255,255,255,.12);
    --copy-bg:#16a34a; --copy-bg2:#059669; --copy-border:rgba(22,163,74,.35);
    --hint:#6b7280; --header-bg:#ffffff; --header-text:#0b1220;
    --ctl-h: 44px;
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#f6f7fb; --card:#ffffff; --muted:#6b7280; --text:#0b1220; --accent:#0ea5e9; --border:rgba(0,0,0,.12);
      --copy-bg:#16a34a; --copy-bg2:#22c55e; --copy-border:rgba(34,197,94,.35);
      --hint:#9ca3af; --header-bg:#ffffff; --header-text:#0b1220;
    }
  }
  html,body{height:100%}
  body{ margin:0; background:var(--bg); color:var(--text);
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial;
    -webkit-font-smoothing: antialiased; line-height:1.35; }
  header{ background: var(--header-bg); color: var(--header-text); width:100%; box-shadow:0 2px 8px rgba(0,0,0,.08); }
  .header-inner{ max-width:1100px; margin:0 auto; padding:18px 16px; display:flex; align-items:center; }
  header h1{ margin:0; font-size:22px; font-weight:800; letter-spacing:.3px; text-transform:uppercase; }
  .container{ max-width:1100px; margin:16px auto 24px; padding:0 16px; }
  .wrap{ display:grid; grid-template-columns: 1fr 1fr; gap:20px; }
  @media (max-width: 900px){ .wrap{ grid-template-columns:1fr; } }
  .card{ background:var(--card); border:1px solid var(--border); border-radius:18px; box-shadow:0 8px 24px rgba(0,0,0,.08); overflow:hidden; }
  .left, .out, .foot { padding:18px; }
  h2{ margin:0 0 10px; font-size:16px; font-weight:700 }
  label{font-size:12px; color:var(--muted); display:block; margin:10px 0 6px}
  input,textarea,select{
    display:block; width:100%; max-width:100%;
    padding:12px; border-radius:12px; border:1px solid var(--border);
    background:transparent; color:var(--text); outline:none; font-size:16px;
    line-height:1.3;
  }
  select{ height: var(--ctl-h); line-height: calc(var(--ctl-h) - 2px); }
  .date-row{ display:flex; gap:8px; align-items:stretch }
  /* Fake date visible */
  .date-wrap{ position:relative; flex:1 }
  .date-fake{
    height: var(--ctl-h); width:100%;
    border:1px solid var(--border); border-radius:12px;
    padding: 10px 12px; display:flex; align-items:center;
    background:transparent; color:var(--text);
    font-size:16px; line-height:1.3; user-select:none;
  }
  .date-native{
    position:absolute; inset:0; width:100%; height:100%;
    opacity:0; /* invisible pero operativo */
    -webkit-appearance: none;
    appearance: none;
  }
  .date-row button{
    flex:0 0 var(--ctl-h); width:var(--ctl-h); height: var(--ctl-h);
    border-radius:12px; border:1px solid var(--border);
    background:var(--card); color:var(--text); font-size:20px; line-height:1; font-weight:700;
    display:flex; align-items:center; justify-content:center; cursor:pointer;
  }

  textarea{ min-height:84px; resize:vertical; }
  textarea::placeholder{ color: var(--hint); opacity:.75; white-space:pre-line; }
  .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
  @media (max-width: 640px){ .row{ grid-template-columns:1fr; } }
  .btn{ appearance:none; border:1px solid var(--border); background:var(--accent); color:#fff;
    padding:12px 16px; border-radius:12px; font-weight:600; cursor:pointer; width:100%; }
  .btn-copy{ width:100%; background:linear-gradient(180deg,var(--copy-bg),var(--copy-bg2));
    border:1px solid var(--copy-border); color:#fff; padding:12px 16px; font-weight:700; border-radius:12px; }
  pre{ margin:0; background:transparent; border:1px dashed var(--border);
    border-radius:12px; padding:14px; white-space:pre-wrap; word-break:break-word; min-height:240px;
    text-align: justify; text-justify: inter-word; }
  .warn{ color:#dc2626; font-size:12px; margin-top:8px }
  .spacer{ height:8px }

  .muted { color: var(--hint); }
</style>
</head>
<body>
  <header>
    <div class="header-inner">
      <h1>RECORDATORIO DE CITAS</h1>
    </div>
  </header>

  <div class="container">
    <div class="wrap">
      <div class="card">
        <div class="left">
          <h2>Datos de partida</h2>

          <label>Fecha de la cita</label>
          <div class="date-row">
            <div class="date-wrap">
              <div id="dateFake" class="date-fake" aria-hidden="true">dd/mm/aaaa</div>
              <input type="date" id="fecha" class="date-native" aria-label="Fecha">
            </div>
            <button id="abrirFecha" type="button" aria-label="Abrir selector de fecha">游늰</button>
          </div>

          <div class="row">
            <div>
              <label>Hora</label>
              <div style="display:flex; gap:8px">
                <select id="hour" aria-label="Hora" style="flex:1">
                  <option value="00">00</option>
<option value="01">01</option>
<option value="02">02</option>
<option value="03">03</option>
<option value="04">04</option>
<option value="05">05</option>
<option value="06">06</option>
<option value="07">07</option>
<option value="08">08</option>
<option value="09">09</option>
<option value="10">10</option>
<option value="11">11</option>
<option value="12" selected>12</option>
<option value="13">13</option>
<option value="14">14</option>
<option value="15">15</option>
<option value="16">16</option>
<option value="17">17</option>
<option value="18">18</option>
<option value="19">19</option>
<option value="20">20</option>
<option value="21">21</option>
<option value="22">22</option>
<option value="23">23</option>
                </select>
                <select id="minute" aria-label="Minutos" style="flex:1">
                  <option value="00" selected>00</option>
                  <option value="15">15</option>
                  <option value="30">30</option>
                  <option value="45">45</option>
                </select>
              </div>
            </div>
            <div>
              <label>Tipo de mensaje</label>
              <select id="tipo">
                <option value="confirmacion">Confirmaci칩n</option>
                <option value="recordatorio">Recordatorio</option>
              </select>
            </div>
          </div>

          <label>Ubicaci칩n</label>
          <textarea id="ubicacion" placeholder="Despacho - Artigas Abogados
Calle Esperanto, 5, 7-B de Benidorm."></textarea>

          <label>Enlace Google Maps <span class="muted">(por defecto: despacho)</span></label>
          <input id="maps" placeholder="https://maps.app.goo.gl/fES91xJhujFg9wdi8">

          <div class="spacer"></div>
          <button class="btn" id="gen" type="button">Generar</button>
        </div>
      </div>

      <div class="card">
        <div class="out">
          <h2>Mensaje generado</h2>
          <pre id="salida" aria-live="polite"></pre>
          <div class="warn" id="warn" hidden>Completa fecha y hora.</div>
          <div class="warn" id="warnMaps" hidden>Ubicaci칩n distinta de despacho detectada. Si quieres incluir el enlace de Google Maps, pega aqu칤 su URL.</div>
        </div>
        <div class="foot">
          <button class="btn-copy" id="copiar" type="button">Copiar</button>
        </div>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js', {scope: './'}).catch(()=>{});
  }

  const fecha = document.getElementById('fecha');
  const fake = document.getElementById('dateFake');
  const btnFecha = document.getElementById('abrirFecha');

  const salida = document.getElementById('salida'), warn = document.getElementById('warn');
  const warnMaps = document.getElementById('warnMaps');
  const hourSel = document.getElementById('hour'), minuteSel = document.getElementById('minute'), tipoSel = document.getElementById('tipo');
  const ubic = document.getElementById('ubicacion'); const maps = document.getElementById('maps');

  const WD = ['domingo','lunes','martes','mi칠rcoles','jueves','viernes','s치bado'];
  const MO = ['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre'];
  const two = n => (n<10? '0'+n : ''+n);
  const DESPACHO_LINK = 'https://maps.app.goo.gl/fES91xJhujFg9wdi8';
  const OFFICE_LINE  = 'Calle Esperanto, 5, 7-B de Benidorm.';

  function ymdToDisplay(ymd){
    const [y,m,d] = ymd.split('-').map(Number);
    if (!y || !m || !d) return 'dd/mm/aaaa';
    return String(d).padStart(2,'0') + '/' + String(m).padStart(2,'0') + '/' + y;
  }

  function ensureDateSet(){
    const today = new Date();
    try{ fecha.valueAsDate = today; }catch(e){
      const y=today.getFullYear(), m=today.getMonth()+1, d=today.getDate();
      fecha.value = `${y}-${(m<10?'0'+m:m)}-${(d<10?'0'+d:d)}`;
    }
    fake.textContent = ymdToDisplay(fecha.value);
  }

  function fmtFecha(dt){
    const wd = WD[dt.getDay()], day = dt.getDate(), month = MO[dt.getMonth()], year = dt.getFullYear();
    return `${wd}, d칤a ${day} de ${month} de ${year}`;
  }
  function fmtHora(dt){ return `${two(dt.getHours())}:${two(dt.getMinutes())} horas`; }

  function isDespacho(text){
    if(!text || !text.trim()) return true;
    const t = text.toLowerCase();
    return t.includes('despacho - artigas abogados') && t.includes('esperanto') && t.includes('benidorm');
  }

  function normalizeExternalLoc(raw){
    if(!raw) return '';
    let s = raw.replace(/\s+/g,' ').trim();
    s = s.replace(/^despacho\s*-\s*artigas abogados\s*/i,'').trim();
    s = s.replace(/,?\s*espa침a\.?$/i,'').trim();
    s = s.replace(/,\s*$/,'');
    if (/alicante\s*\(alicante\)/i.test(s)) return s;
    if (/\balicante\b/i.test(s) && !/\(alicante\)/i.test(s)) return s + ' (Alicante)';
    return s;
  }

  function getSelectedDateTime(){
    let dt;
    try { dt = fecha.valueAsDate; } catch(e) { dt = null; }
    if (!dt || isNaN(dt)) {
      const [y,m,d]=(fecha.value||'').split('-').map(Number);
      dt = new Date(y||0, (m||1)-1, d||1, 0, 0, 0, 0);
    }
    const hh = Number((document.getElementById('hour')||{}).value || '12');
    const mm = Number((document.getElementById('minute')||{}).value || '00');
    dt.setHours(hh, mm, 0, 0);
    return dt;
  }

  function genConfirmDespacho(dt, link){
    const f = fmtFecha(dt), h = fmtHora(dt);
    const l = (link && link.trim()) ? link.trim() : DESPACHO_LINK;
    return [
      'Estimado/a cliente:',
      '',
      `Le confirmamos su cita en Artigas Abogados para el ${f}, a las ${h}, en nuestro despacho sito en ${OFFICE_LINE}`,
      '',
      l,
      '',
      'En caso de que no pudiera acudir, le agradecer칤amos que nos lo comunicara respondiendo a este mismo WhatsApp o al correo info@artigasabogados.com, con el fin de reorganizar la agenda y poder establecer una nueva cita.',
      '',
      'Un cordial saludo,',
      'Artigas Abogados'
    ].join('\n');
  }
  function genRecordDespacho(dt, link){
    const h = fmtHora(dt);
    const l = (link && link.trim()) ? link.trim() : DESPACHO_LINK;
    return [
      'Estimado/a cliente:',
      '',
      `Le recordamos su cita en Artigas Abogados para ma침ana a las ${h}, en nuestro despacho sito en ${OFFICE_LINE}`,
      '',
      l,
      '',
      'En caso de que no pudiera acudir, le agradecer칤amos que nos lo comunicara respondiendo a este mismo WhatsApp o al correo info@artigasabogados.com, con el fin de reorganizar la agenda.',
      '',
      'Un cordial saludo,',
      'Artigas Abogados'
    ].join('\n');
  }
  function genConfirmOtra(dt, locRaw, link){
    const f = fmtFecha(dt), h = fmtHora(dt);
    const loc = normalizeExternalLoc(locRaw);
    const lines = [
      'Estimado/a cliente:',
      '',
      `Le confirmamos su cita con Adolfo Artigas para el ${f}, a las ${h}, en ${loc}`,
      ''
    ];
    if (link && link.trim()) { lines.push(link.trim(), ''); }
    lines.push('En caso de que no pudiera asistir, le agradecer칤amos que nos lo comunicara respondiendo a este mismo WhatsApp o al correo info@artigasabogados.com, con el fin de reorganizar la agenda.');
    lines.push('', 'Un cordial saludo,', 'Artigas Abogados');
    return lines.join('\n');
  }
  function genRecordOtra(dt, locRaw, link){
    const h = fmtHora(dt);
    const loc = normalizeExternalLoc(locRaw);
    const lines = [
      'Estimado/a cliente:',
      '',
      `Le recordamos su cita con Adolfo Artigas para ma침ana a las ${h}, en ${loc}`,
      ''
    ];
    if (link && link.trim()) { lines.push(link.trim(), ''); }
    lines.push('En caso de que no pudiera asistir, le agradecer칤amos que nos lo comunicara respondiendo a este mismo WhatsApp o al correo info@artigasabogados.com, con el fin de reorganizar la agenda.');
    lines.push('', 'Un cordial saludo,', 'Artigas Abogados');
    return lines.join('\n');
  }

  function generar(){
    const dt = getSelectedDateTime();
    if(!dt || isNaN(dt.getTime())){
      warn.hidden=false; salida.textContent='';
      return;
    }
    warn.hidden=true;
    const desp = isDespacho(ubic.value);
    let text='';
    warnMaps.hidden = true;

    if(tipoSel.value === 'confirmacion'){
      text = desp ? genConfirmDespacho(dt, maps.value) : genConfirmOtra(dt, ubic.value, maps.value);
    }else{
      text = desp ? genRecordDespacho(dt, maps.value) : genRecordOtra(dt, ubic.value, maps.value);
    }

    if (!desp && !(maps.value && maps.value.trim())) {
      warnMaps.hidden = false;
    }

    salida.textContent = text;
  }

  // Inicializaci칩n
  ensureDateSet();
  document.getElementById('hour').value = '12';
  document.getElementById('minute').value = '00';
  generar();

  // Sincroniza fake cuando cambie nativo
  fecha.addEventListener('change', ()=>{
    fake.textContent = ymdToDisplay(fecha.value);
  });

  // Abrir picker al pulsar fake o bot칩n
  function openPicker(){
    if (typeof fecha.showPicker === 'function') {
      try { fecha.showPicker(); return; } catch(e){}
    }
    fecha.focus();
  }
  fake.addEventListener('click', openPicker);
  btnFecha.addEventListener('click', openPicker);

  // Acceso por teclado: si el nativo recibe foco, no pasa nada; el valor se refleja en change
});
</script>
</body>
</html>