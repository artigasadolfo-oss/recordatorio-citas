<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>RECORDATORIO DE CITAS</title>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<link rel="manifest" href="manifest.webmanifest?v=2">
<link rel="apple-touch-icon" href="icon-180.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#0ea5e9">
<style>
  *,*::before,*::after{ box-sizing:border-box }

  /* ===== Paleta base (oscuro por defecto con contraste alto) ===== */
  :root{
    --bg:#0b1220;         /* fondo general */
    --panel:#0f1629;      /* cabecera */
    --card:#141d33;       /* tarjetas */
    --elev:#1a2440;       /* elementos elevados */

    --text:#e6ebf5;
    --muted:#9aa4b2;
    --hint:#8090a7;
    --border:rgba(230,235,245,.10);

    --accent:#11a6ea;
    --copy-bg:#16a34a; --copy-bg2:#0f9d47; --copy-border:rgba(34,197,94,.28);
    --reset-bg:#ef4444; --reset-bg2:#dc2626; --reset-border:rgba(239,68,68,.38);

    --ctl-h:44px;
  }

  /* ===== Modo claro con contraste (nada de ‚Äútodo blanco‚Äù) ===== */
  @media (prefers-color-scheme: light){
    :root{
      --bg:#e9eef6;
      --panel:#ffffff;
      --card:#f3f6fb;
      --elev:#eef3ff;

      --text:#0b1220;
      --muted:#5b6473;
      --hint:#8892a6;
      --border:rgba(10,25,50,.12);

      --accent:#0ea5e9;
      --copy-bg:#16a34a; --copy-bg2:#22c55e; --copy-border:rgba(34,197,94,.28);
      --reset-bg:#ef4444; --reset-bg2:#f87171; --reset-border:rgba(239,68,68,.30);
    }
  }

  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial;
    -webkit-font-smoothing: antialiased; line-height:1.35;

    /* Fondo con degradados suaves para que JAM√ÅS se vea ‚Äútodo blanco‚Äù */
    background:
      radial-gradient(1200px 800px at 20% -10%, rgba(14,165,233,.12), transparent 55%),
      radial-gradient(1100px 700px at 100% 10%, rgba(34,197,94,.08), transparent 45%),
      var(--bg);
  }

  header{
    background: var(--panel); color: var(--text);
    width:100%; box-shadow:0 2px 10px rgba(0,0,0,.18);
    border-bottom:1px solid var(--border);
  }
  .header-inner{ max-width:1100px; margin:0 auto; padding:18px 16px; display:flex; align-items:center; }
  header h1{ margin:0; font-size:22px; font-weight:800; letter-spacing:.3px; text-transform:uppercase; }

  .container{ max-width:1100px; margin:16px auto 24px; padding:0 16px; }
  .wrap{ display:grid; grid-template-columns: 1fr 1fr; gap:20px; }
  @media (max-width: 900px){ .wrap{ grid-template-columns:1fr; } }

  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:18px;
    box-shadow:
      0 10px 24px rgba(0,0,0,.22),
      inset 0 1px 0 rgba(255,255,255,.02);
    overflow:hidden;
  }
  .left, .out, .foot { padding:18px; }

  h2{ margin:0 0 10px; font-size:16px; font-weight:700 }
  label{font-size:12px; color:var(--muted); display:block; margin:10px 0 6px}

  input,textarea,select{
    display:block; width:100%; max-width:100%;
    padding:12px; border-radius:12px; border:1px solid var(--border);
    background:rgba(255,255,255,.05); color:var(--text); outline:none; font-size:16px; line-height:1.3;
    box-shadow: inset 0 1px 2px rgba(0,0,0,.12);
  }
  @media (prefers-color-scheme: light){
    input,textarea,select{ background:rgba(255,255,255,.7); box-shadow: inset 0 1px 2px rgba(0,0,0,.06); }
  }
  input:focus, textarea:focus, select:focus{
    border-color: rgba(14,165,233,.45);
    box-shadow: 0 0 0 3px rgba(14,165,233,.15);
  }
  select{ height: var(--ctl-h); line-height: calc(var(--ctl-h) - 2px); }

  .date-row{ display:flex; gap:8px; align-items:center; }
  .date-wrap{ position:relative; flex:1 }
  .date-fake{
    height: var(--ctl-h); width:100%;
    border:1px solid var(--border); border-radius:12px;
    padding: 10px 12px; display:flex; align-items:center;
    background:rgba(255,255,255,.05); color:var(--text);
    font-size:16px; line-height:1.3; user-select:none;
  }
  @media (prefers-color-scheme: light){
    .date-fake{ background:rgba(255,255,255,.7); }
  }
  .date-native{ position:absolute; inset:0; width:100%; height:100%; opacity:0; -webkit-appearance:none; appearance:none; }
  .date-row button{
    flex:0 0 auto; height: var(--ctl-h); padding:0 14px; border-radius:12px;
    border:1px solid var(--border);
    background:linear-gradient(180deg, var(--panel), rgba(255,255,255,.02));
    color:var(--text); font-size:15px; font-weight:700;
    display:inline-flex; align-items:center; justify-content:center; gap:10px; cursor:pointer; line-height:1;
  }
  .date-row button:hover,.date-row button:focus-visible{
    outline:none; border-color: rgba(14,165,233,.5);
    box-shadow: 0 0 0 3px rgba(14,165,233,.15);
  }

  textarea{ min-height:84px; resize:vertical; }
  textarea::placeholder{ color: var(--hint); opacity:.75; white-space:pre-line; }

  .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
  @media (max-width: 640px){ .row{ grid-template-columns:1fr; } }

  .btn-copy{
    width:100%; background:linear-gradient(180deg,var(--copy-bg),var(--copy-bg2));
    border:1px solid var(--copy-border); color:#fff; padding:12px 16px; font-weight:700; border-radius:12px; cursor:pointer;
    box-shadow: 0 6px 20px rgba(22,163,74,.20);
  }
  .btn-reset{
    width:100%; background:linear-gradient(180deg,var(--reset-bg),var(--reset-bg2));
    border:1px solid var(--reset-border); color:#fff; padding:12px 16px; font-weight:700; border-radius:12px; cursor:pointer;
    box-shadow: 0 6px 20px rgba(239,68,68,.22);
  }
  .foot-actions{ display:grid; grid-template-columns:1fr 1fr; gap:12px }

  .btn-copy:is(:active,.is-pressed), .btn-reset:is(:active,.is-pressed){
    filter: brightness(.9);
    box-shadow: inset 0 0 0 9999px rgba(0,0,0,.08);
  }
  .btn-copy:disabled, .btn-reset:disabled{ opacity:.6; cursor:not-allowed; }

  pre{
    margin:0; background:var(--elev);
    border:1px dashed var(--border);
    border-radius:12px; padding:14px; white-space:pre-wrap; word-break:break-word; min-height:240px;
    text-align: justify; text-justify: inter-word;
    box-shadow: inset 0 1px 2px rgba(0,0,0,.10);
  }
  .warn{ color:#fca5a5; font-size:12px; margin-top:8px }
  .spacer{ height:8px }
  .muted { color: var(--hint); }
</style>
</head>
<body>
  <header>
    <div class="header-inner">
      <h1>RECORDATORIO DE CITAS</h1>
    </div>
  </header>

  <div class="container">
    <div class="wrap">
      <div class="card">
        <div class="left">
          <h2>Datos de partida</h2>

          <label>Fecha de la cita</label>
          <div class="date-row">
            <div class="date-wrap">
              <div id="dateFake" class="date-fake" aria-hidden="true">dd/mm/aaaa</div>
              <input type="date" id="fecha" class="date-native" aria-label="Fecha">
            </div>
            <button id="abrirFecha" type="button" aria-label="Abrir selector de fecha">üìÖ <span style="font-weight:600">Seleccionar fecha</span></button>
          </div>

          <div class="row">
            <div>
              <label>Hora</label>
              <div style="display:flex; gap:8px">
                <select id="hour" aria-label="Hora" style="flex:1">
                  <option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option>
                  <option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option>
                  <option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option>
                  <option value="12" selected>12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option>
                  <option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option>
                  <option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option>
                </select>
                <select id="minute" aria-label="Minutos" style="flex:1">
                  <option value="00" selected>00</option><option value="15">15</option><option value="30">30</option><option value="45">45</option>
                </select>
              </div>
            </div>
            <div>
              <label>Tipo de mensaje</label>
              <select id="tipo">
                <option value="confirmacion">Confirmaci√≥n</option>
                <option value="recordatorio">Recordatorio</option>
              </select>
            </div>
          </div>

          <label>Ubicaci√≥n</label>
          <textarea id="ubicacion" placeholder="C/ Esperanto, 5, 7¬∫-B de Benidorm.">C/ Esperanto, 5, 7¬∫-B de Benidorm.</textarea>

          <label>Enlace Google Maps <span class="muted">(si es el despacho lo puedes dejar en blanco; si es otra direcci√≥n, se a√±ade solo si lo pegas aqu√≠)</span></label>
          <input id="maps" value="https://maps.app.goo.gl/fES91xJhujFg9wdi8" placeholder="https://maps.app.goo.gl/‚Ä¶">

          <div class="spacer"></div>
          <!-- Sin bot√≥n Generar: autogeneraci√≥n -->
        </div>
      </div>

      <div class="card">
        <div class="out">
          <h2>Mensaje generado</h2>
          <pre id="salida" aria-live="polite"></pre>
          <div class="warn" id="warn" hidden>Completa fecha y hora.</div>
        </div>
        <div class="foot">
          <div class="foot-actions">
            <button class="btn-copy" id="copiar" type="button">Copiar</button>
            <button class="btn-reset" id="reiniciar" type="button">Reiniciar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  // Registro del SW con ‚Äúcache-buster‚Äù para evitar servir HTML antiguo
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js?v=2', {scope: './'}).catch(()=>{});
  }

  // DOM
  const fecha = document.getElementById('fecha');
  const fake  = document.getElementById('dateFake');
  const btnFecha = document.getElementById('abrirFecha');
  const salida = document.getElementById('salida');
  const warn   = document.getElementById('warn');
  const hourSel = document.getElementById('hour');
  const minuteSel = document.getElementById('minute');
  const tipoSel = document.getElementById('tipo');
  const ubic   = document.getElementById('ubicacion');
  const maps   = document.getElementById('maps');
  const btnCopiar = document.getElementById('copiar');
  const btnReiniciar = document.getElementById('reiniciar');

  // Utils
  const WD = ['domingo','lunes','martes','mi√©rcoles','jueves','viernes','s√°bado'];
  const MO = ['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre'];
  const two = n => (n<10? '0'+n : ''+n);
  const DESPACHO_TXT = 'C/ Esperanto, 5, 7¬∫-B de Benidorm.'; // comparaci√≥n exacta
  const DEFAULT_MAPS = 'https://maps.app.goo.gl/fES91xJhujFg9wdi8';

  function ymdToDisplay(ymd){
    const [y,m,d] = (ymd||'').split('-').map(Number);
    if(!y||!m||!d) return 'dd/mm/aaaa';
    return String(d).padStart(2,'0') + '/' + String(m).padStart(2,'0') + '/' + y;
  }
  function fmtFecha(dt){ return `${WD[dt.getDay()]} ${dt.getDate()} de ${MO[dt.getMonth()]} de ${dt.getFullYear()}`; }
  function fmtHora(dt){ return `${two(dt.getHours())}:${two(dt.getMinutes())} horas`; }
  function isTomorrow(dt){
    const now = new Date();
    const a = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const b = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate());
    return ((b - a) / 86400000) === 1;
  }
  function getSelectedDateTime(){
    let dt = null;
    try { dt = fecha.valueAsDate || null; } catch(e){ dt = null; }
    if (!dt) {
      const [y,m,d]=(fecha.value||'').split('-').map(Number);
      if (!y||!m||!d) return null;
      dt = new Date(y, m-1, d);
    }
    dt.setHours(Number(hourSel.value||'12'), Number(minuteSel.value||'00'), 0, 0);
    return dt;
  }

  // Mensajes (misma l√≥gica que ten√≠as)
  function msgConfirmDespacho(dt){
    return [
      'Estimado/a cliente:',
      '',
      `Le confirmamos su cita con Adolfo Artigas para el ${fmtFecha(dt)} a las ${fmtHora(dt)}, en nuestro despacho ubicado en ${DESPACHO_TXT}`,
      '',
      (maps.value.trim() || DEFAULT_MAPS),
      '',
      'En caso de que no pudiera asistir, le agradecer√≠amos que nos lo comunicara respondiendo a este mismo WhatsApp, con el fin de reorganizar la agenda y poder fijar una nueva cita.',
      '',
      'Reciba un cordial saludo.'
    ].join('\n');
  }
  function msgRecordDespacho(dt){
    const cuando = isTomorrow(dt) ? `ma√±ana a las ${fmtHora(dt)}` : `el ${fmtFecha(dt)} a las ${fmtHora(dt)}`;
    return [
      'Estimado/a cliente:',
      '',
      `Le recordamos su cita con Adolfo Artigas para ${cuando}, en nuestro despacho ubicado en ${DESPACHO_TXT}`,
      '',
      (maps.value.trim() || DEFAULT_MAPS),
      '',
      'En caso de que no pudiera asistir, le agradecer√≠amos que nos lo comunicara respondiendo a este mismo WhatsApp, con el fin de reorganizar la agenda y poder fijar una nueva cita.',
      '',
      'Reciba un cordial saludo.'
    ].join('\n');
  }

  function msgConfirmOtra(dt, dir, link){
    const lines = [
      'Estimado/a cliente:',
      '',
      `Le confirmamos su cita con Adolfo Artigas para el ${fmtFecha(dt)} a las ${fmtHora(dt)}, en ${dir}.`,
      ''
    ];
    const l = (link && link.trim()) ? link.trim() : '';
    if (l) lines.push(l, '');
    lines.push('En caso de que no pudiera asistir, le agradecer√≠amos que nos lo comunicara respondiendo a este mismo WhatsApp, con el fin de reorganizar la agenda y poder fijar una nueva cita.','', 'Reciba un cordial saludo.');
    return lines.join('\n');
  }
  function msgRecordOtra(dt, dir, link){
    const cuando = isTomorrow(dt) ? `ma√±ana a las ${fmtHora(dt)}` : `el ${fmtFecha(dt)} a las ${fmtHora(dt)}`;
    const lines = [
      'Estimado/a cliente:',
      '',
      `Le recordamos su cita con Adolfo Artigas para ${cuando}, en ${dir}.`,
      ''
    ];
    const l = (link && link.trim()) ? link.trim() : '';
    if (l) lines.push(l, '');
    lines.push('En caso de que no pudiera asistir, le agradecer√≠amos que nos lo comunicara respondiendo a este mismo WhatsApp, con el fin de reorganizar la agenda y poder fijar una nueva cita.','', 'Reciba un cordial saludo.');
    return lines.join('\n');
  }

  function msgConfirmSinDir(dt){
    return [
      'Estimado/a cliente:',
      '',
      `Le confirmamos su cita con Adolfo Artigas para el ${fmtFecha(dt)} a las ${fmtHora(dt)}.`,
      '',
      'En caso de que no pudiera asistir, le agradecer√≠amos que nos lo comunicara respondiendo a este mismo WhatsApp, con el fin de reorganizar la agenda y poder fijar una nueva cita.',
      '',
      'Reciba un cordial saludo.'
    ].join('\n');
  }
  function msgRecordSinDir(dt){
    const cuando = isTomorrow(dt) ? `ma√±ana a las ${fmtHora(dt)}` : `el ${fmtFecha(dt)} a las ${fmtHora(dt)}`;
    return [
      'Estimado/a cliente:',
      '',
      `Le recordamos su cita con Adolfo Artigas para ${cuando}.`,
      '',
      'En caso de que no pudiera asistir, le agradecer√≠amos que nos lo comunicara respondiendo a este mismo WhatsApp, con el fin de reorganizar la agenda y poder fijar una nueva cita.',
      '',
      'Reciba un cordial saludo.'
    ].join('\n');
  }

  function generar(){
    const dt = getSelectedDateTime();
    if(!dt || isNaN(dt.getTime())){
      warn.hidden = false; salida.textContent = ''; return;
    }
    warn.hidden = true;

    const dirRaw = (ubic.value || '').trim();
    const linkRaw = (maps.value || '').trim();
    let texto = '';

    if (dirRaw === '') {
      texto = (tipoSel.value === 'confirmacion') ? msgConfirmSinDir(dt) : msgRecordSinDir(dt);
    } else if (dirRaw === DESPACHO_TXT) {
      texto = (tipoSel.value === 'confirmacion') ? msgConfirmDespacho(dt) : msgRecordDespacho(dt);
    } else {
      texto = (tipoSel.value === 'confirmacion') ? msgConfirmOtra(dt, dirRaw, linkRaw) : msgRecordOtra(dt, dirRaw, linkRaw);
    }

    salida.textContent = texto;
  }

  // Inicializaci√≥n (ma√±ana)
  function setTomorrow(){
    const t = new Date();
    t.setDate(t.getDate() + 1);
    try { fecha.valueAsDate = t; } catch(e){
      const y=t.getFullYear(), m=t.getMonth()+1, d=t.getDate();
      fecha.value = `${y}-${(m<10?'0'+m:m)}-${(d<10?'0'+d:d)}`;
    }
    fake.textContent = ymdToDisplay(fecha.value);
  }
  setTomorrow();

  // Reset total
  function resetAll(){
    setTomorrow();
    hourSel.value = '12';
    minuteSel.value = '00';
    tipoSel.value = 'confirmacion';
    ubic.value = DESPACHO_TXT;
    maps.value = DEFAULT_MAPS;
    generar();
  }

  // Feedback sombreados
  function pressEffect(btn){
    btn.classList.add('is-pressed');
    btn.disabled = true;
    setTimeout(()=>{ btn.classList.remove('is-pressed'); btn.disabled=false; }, 350);
  }

  // Eventos + autogeneraci√≥n
  function openNativePicker(){
    if (typeof fecha.showPicker === 'function') { try { fecha.showPicker(); return; } catch(e){} }
    try { fecha.click(); } catch(e){}
    fecha.focus();
  }
  document.getElementById('abrirFecha').addEventListener('click', openNativePicker);
  fake.addEventListener('click', openNativePicker);

  fecha.addEventListener('change', ()=>{ fake.textContent = ymdToDisplay(fecha.value); generar(); });
  hourSel.addEventListener('change', generar);
  minuteSel.addEventListener('change', generar);
  tipoSel.addEventListener('change', generar);

  // Reglas Ubicaci√≥n/Maps
  ubic.addEventListener('input', ()=>{
    const dir = (ubic.value || '').trim();
    if (dir === '' || dir !== DESPACHO_TXT) {
      if ((maps.value || '').trim() === DEFAULT_MAPS) { maps.value = ''; }
    }
    generar();
  });
  maps.addEventListener('input', generar);

  btnCopiar.addEventListener('click', ()=>{ navigator.clipboard.writeText(salida.textContent); pressEffect(btnCopiar); });
  btnReiniciar.addEventListener('click', ()=>{ resetAll(); pressEffect(btnReiniciar); });

  // Primer render
  generar();
});
</script>
</body>
</html>